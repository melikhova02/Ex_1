---
title: "Лабораторная_1"
author: "Мелихова И.С."
date: "12 02 2020"
output: html_document
---
## Аналитический пакет R
### Упражнение 1
### Парсинг HTML
#Задача
 С помощью пакета rvest или парсинга XML с помощью xpath запросов соберите данные с сайта согласно своему варианту. В итоговой таблице должно быть не менее 50 записей и не менее 8 признаков, из которых как минимум два количественных. Снабдите файл справочником в формате Markdown.
Данные
Яндекс.Маркет, планшеты (Москва)
##Признаки
#Title- название планшета
#Rank- рейтинг планшета в списке самых покупаемых планшетов в Москве 
#Price- цена планшета
#Загрузка библиотек.
```{r}  
library('RCurl')  
library('XML')                 # разбор XML-файлов
library('rjson')               # чтение формата JSON
library('rvest')               # работа с DOM сайта
library('dplyr')               
```
#Загрузка текста html-страницы.
```{r}
fileURL <- "https://market.yandex.ru/catalog--planshety/54545/list?hid=6427100&suggest_text=%D0%9F%D0%BB%D0%B0%D0%BD%D1%88%D0%B5%D1%82%D1%8B&rs=eJwzYgpgBAABcwCG&suggest_history=1&local-offers-first=0&onstock=1&how=quality&page=2"
html <- getURL(fileURL)
# разбираем как html
doc <- htmlParse(html)
rootNode <- xmlRoot(doc)
```
#Выбирем наименования моделей и просмотрим первые три из них.
```{r}
m <- xpathSApply(rootNode, '//span[@class="a-text-normal"]/a',xmlValue)
m[1:3]
```
#Выбирем цены моделей и просмотрим первые три из них.
```{r}
p <- xpathSApply(rootNode, '//span[@class="a-price"]/a',xmlValue)
p <- as.numeric(gsub('[^0-9\\.]', '', p))
# просмотр первых трёх элементов вектора
p[1:3]
```
#Выбирем рейтинги моделей и просмотрим первые три из них.
```{r}
r <- xpathSApply(rootNode, '//div[@class="rating__value"]', xmlValue)
r[1:3]
```
#Убедимся в одинаковом количестве строк во всех признаках.
```{r}
length(m)
length(p)
length(r)
```
#Объединяем во фрейм и сохраняем csv-файл.
```{r}
DF.price <- data.frame( Model = m, Price = p, Rank = r,  stringsAsFactors = FALSE)
# просмотр результата
dim(DF.price) # размерность
str(DF.price) # структура
write.csv(DF.price, file = './DF_price.csv', row.names = F)
``` the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
 